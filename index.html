<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–†–∞–±–æ—á–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å 2026</title>
<style>
:root {
  --bg: #f8fafc;
  --text: #0f172a;
  --card: #ffffff;
  --border: #e2e8f0;
  --week-ok: #d1fae5;
  --accent: #3b82f6;
  --accent-light: #dbeafe;
  --shadow: rgba(0,0,0,0.1);
}
body.dark {
  --bg: #0f172a;
  --text: #f1f5f9;
  --card: #1e293b;
  --border: #334155;
  --week-ok: #064e3b;
  --accent: #60a5fa;
  --accent-light: #1e3a8a;
  --shadow: rgba(0,0,0,0.3);
}

* { box-sizing: border-box; }
body {
  margin:0; padding:0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  transition: background 0.3s, color 0.3s;
}

.header {
  background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
  color: white;
  padding: 24px;
  box-shadow: 0 4px 6px var(--shadow);
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-content {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 16px;
}

h1 { margin: 0; font-size: 28px; font-weight: 700; }

.stats {
  display: flex;
  gap: 24px;
  align-items: center;
}

.stat-item {
  text-align: center;
}

.stat-value {
  font-size: 24px;
  font-weight: 700;
  display: block;
}

.stat-label {
  font-size: 12px;
  opacity: 0.9;
}

.theme-btn {
  background: rgba(255,255,255,0.2);
  border: none;
  border-radius: 8px;
  padding: 8px 16px;
  color: white;
  cursor: pointer;
  font-size: 20px;
  transition: background 0.2s;
}

.theme-btn:hover {
  background: rgba(255,255,255,0.3);
}

.container {
  max-width: 1400px;
  margin: 24px auto;
  padding: 0 24px;
}

.month-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 24px;
  margin-bottom: 40px;
}

.month-card {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 2px 8px var(--shadow);
  transition: transform 0.2s, box-shadow 0.2s;
}

.month-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 16px var(--shadow);
}

.month-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border);
}

.month-name {
  font-size: 20px;
  font-weight: 700;
  color: var(--accent);
}

.month-hours {
  font-size: 14px;
  font-weight: 600;
  padding: 4px 12px;
  background: var(--accent-light);
  border-radius: 12px;
  color: var(--accent);
}

.weekdays {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-bottom: 8px;
}

.weekday {
  text-align: center;
  font-size: clamp(9px, 1.5vw, 11px);
  font-weight: 700;
  color: var(--accent);
  padding: 4px 2px;
}

.days-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
}

.day {
  background: var(--bg);
  border-radius: 8px;
  padding: 4px;
  display: flex;
  flex-direction: column;
  cursor: pointer;
  transition: all 0.2s;
  border: 2px solid transparent;
  position: relative;
  min-height: 50px;
  aspect-ratio: 1;
  overflow: hidden;
}

.day:hover {
  border-color: var(--accent);
  transform: scale(1.05);
}

.day.other {
  opacity: 0.25;
}

.day.today {
  border-color: #ef4444;
  background: linear-gradient(135deg, #fee2e2 0%, var(--bg) 100%);
}

.day-number {
  font-size: clamp(10px, 2vw, 13px);
  font-weight: 700;
  text-align: center;
  margin-bottom: 2px;
  flex-shrink: 0;
}

.day.week-complete {
  background: var(--week-ok);
}

.day-blocks {
  display: flex;
  flex-direction: column;
  gap: 2px;
  flex-grow: 1;
  overflow: hidden;
}

.mini-block {
  height: 3px;
  border-radius: 2px;
  cursor: pointer;
  flex-shrink: 0;
}

.mini-block.work { background: #3b82f6; }
.mini-block.over { background: #f59e0b; }
.mini-block.study { background: #8b5cf6; }

.day-total {
  font-size: clamp(8px, 1.5vw, 9px);
  text-align: center;
  font-weight: 600;
  color: var(--accent);
  margin-top: 2px;
  flex-shrink: 0;
}

.modal {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 200;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.modal.open { display: flex; }

.modal-content {
  background: var(--card);
  border-radius: 16px;
  padding: 24px;
  max-width: 500px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 40px var(--shadow);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-title {
  font-size: 20px;
  font-weight: 700;
}

.close-btn {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--text);
  padding: 0;
  width: 32px;
  height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.close-btn:hover {
  background: var(--border);
}

.blocks-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 20px;
}

.block-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  border-radius: 8px;
  background: var(--bg);
  gap: 8px;
}

.block-item.work { border-left: 4px solid #3b82f6; }
.block-item.over { border-left: 4px solid #f59e0b; }
.block-item.study { border-left: 4px solid #8b5cf6; }

.block-text {
  flex-grow: 1;
  font-size: 14px;
}

.block-text[contenteditable="true"] {
  outline: 2px solid var(--accent);
  padding: 4px;
  border-radius: 4px;
}

.delete-block-btn {
  background: #ef4444;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 6px 12px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 600;
}

.delete-block-btn:hover {
  background: #dc2626;
}

.add-buttons {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
}

.add-btn {
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 12px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
  transition: background 0.2s;
}

.add-btn:hover {
  background: #2563eb;
}

.add-btn.custom {
  background: #8b5cf6;
}

.add-btn.custom:hover {
  background: #7c3aed;
}

@media (max-width: 768px) {
  .month-grid {
    grid-template-columns: 1fr;
  }
  
  .stats {
    width: 100%;
    justify-content: space-around;
  }
  
  h1 {
    font-size: 22px;
  }
  
  .day {
    min-height: 40px;
    padding: 2px;
  }
  
  .day-number {
    font-size: 11px;
    margin-bottom: 1px;
  }
  
  .mini-block {
    height: 2px;
  }
  
  .day-total {
    font-size: 8px;
    margin-top: 1px;
  }
}
</style>
</head>
<body>

<div class="header">
  <div class="header-content">
    <h1>üìÖ –†–∞–±–æ—á–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å 2026</h1>
    <div class="stats">
      <div class="stat-item">
        <span class="stat-value" id="totalHours">0</span>
        <span class="stat-label">—á–∞—Å–æ–≤ –≤ –≥–æ–¥—É</span>
      </div>
      <div class="stat-item">
        <span class="stat-value" id="completeWeeks">0</span>
        <span class="stat-label">–ø–æ–ª–Ω—ã—Ö –Ω–µ–¥–µ–ª—å</span>
      </div>
    </div>
    <button class="theme-btn" onclick="toggleTheme()">üåì</button>
  </div>
</div>

<div class="container">
  <div class="month-grid" id="calendar"></div>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">–î–µ–Ω—å</div>
      <button class="close-btn" onclick="closeModal()">√ó</button>
    </div>
    
    <div class="blocks-list" id="blocksList"></div>
    
    <div class="add-buttons">
      <button class="add-btn" onclick="addBlock('w8a')">–†–∞–±–æ—Ç–∞ 8—á<br>(9-17)</button>
      <button class="add-btn" onclick="addBlock('w4m')">–†–∞–±–æ—Ç–∞ 4—á<br>(9-13)</button>
      <button class="add-btn" onclick="addBlock('w4e')">–†–∞–±–æ—Ç–∞ 4—á<br>(13-17)</button>
      <button class="add-btn" onclick="addBlock('over')">–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞<br>8—á</button>
      <button class="add-btn custom" onclick="addBlock('study')">–£—á—ë–±–∞</button>
      <button class="add-btn custom" onclick="addBlock('custom')">–°–≤–æ–π –±–ª–æ–∫</button>
    </div>
  </div>
</div>

<script>
const year = 2026;
const monthNames = ['–Ø–Ω–≤–∞—Ä—å','–§–µ–≤—Ä–∞–ª—å','–ú–∞—Ä—Ç','–ê–ø—Ä–µ–ª—å','–ú–∞–π','–ò—é–Ω—å','–ò—é–ª—å','–ê–≤–≥—É—Å—Ç','–°–µ–Ω—Ç—è–±—Ä—å','–û–∫—Ç—è–±—Ä—å','–ù–æ—è–±—Ä—å','–î–µ–∫–∞–±—Ä—å'];
const dayNames = ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'];

const blockTypes = {
  w8a: { text: '–†–∞–±–æ—Ç–∞ 8—á (9:00‚Äì17:00)', hours: 8, cls: 'work' },
  w4m: { text: '–†–∞–±–æ—Ç–∞ 4—á (9:00‚Äì13:00)', hours: 4, cls: 'work' },
  w4e: { text: '–†–∞–±–æ—Ç–∞ 4—á (13:00‚Äì17:00)', hours: 4, cls: 'work' },
  over: { text: '–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ (9:00‚Äì17:00)', hours: 8, cls: 'over' },
  study: { text: '–£—á—ë–±–∞', hours: 0, cls: 'study' },
  custom: { text: '–°–≤–æ–π –±–ª–æ–∫', hours: 0, cls: 'study' }
};

let state = {};
let currentDay = null;

function save() {
  try {
    localStorage.setItem('workCalendar2026', JSON.stringify(state));
  } catch(e) {
    console.error('Save error:', e);
  }
}

function load() {
  try {
    const data = localStorage.getItem('workCalendar2026');
    state = data ? JSON.parse(data) : {};
  } catch(e) {
    console.error('Load error:', e);
    state = {};
  }
}

function toggleTheme() {
  document.body.classList.toggle('dark');
  localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
}

function getDayBlocks(dayKey) {
  return (state[dayKey] || []).map(b => 
    typeof b === 'string' ? { type: b } : b
  );
}

function getDayHours(dayKey) {
  return getDayBlocks(dayKey).reduce((sum, b) => {
    const def = blockTypes[b.type];
    return sum + (def ? def.hours : 0);
  }, 0);
}

function getWeekDays(startDate) {
  const days = [];
  const d = new Date(startDate);
  for(let i = 0; i < 7; i++) {
    days.push(d.toISOString().slice(0, 10));
    d.setDate(d.getDate() + 1);
  }
  return days;
}

function isWeekComplete(startDate) {
  const days = getWeekDays(startDate);
  const total = days.reduce((sum, key) => sum + getDayHours(key), 0);
  return total === 20;
}

function renderMonth(monthIndex) {
  const card = document.createElement('div');
  card.className = 'month-card';
  
  const firstDay = new Date(year, monthIndex, 1);
  const lastDay = new Date(year, monthIndex + 1, 0);
  
  // Calculate month hours
  let monthHours = 0;
  for(let d = 1; d <= lastDay.getDate(); d++) {
    const key = `${year}-${String(monthIndex+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    monthHours += getDayHours(key);
  }
  
  card.innerHTML = `
    <div class="month-header">
      <div class="month-name">${monthNames[monthIndex]}</div>
      <div class="month-hours">${monthHours}—á</div>
    </div>
    <div class="weekdays">
      ${dayNames.map(n => `<div class="weekday">${n}</div>`).join('')}
    </div>
    <div class="days-grid" id="month-${monthIndex}"></div>
  `;
  
  const grid = card.querySelector('.days-grid');
  
  // Start from Monday of first week
  let d = new Date(firstDay);
  const startOffset = (d.getDay() + 6) % 7;
  d.setDate(d.getDate() - startOffset);
  
  const today = new Date().toISOString().slice(0, 10);
  
  // Render 6 weeks (42 days) to always show complete grid
  for(let i = 0; i < 42; i++) {
    const dayKey = d.toISOString().slice(0, 10);
    const dayEl = document.createElement('div');
    dayEl.className = 'day';
    
    if(d.getMonth() !== monthIndex) dayEl.classList.add('other');
    if(dayKey === today) dayEl.classList.add('today');
    
    // Check if week is complete
    const dayOfWeek = (d.getDay() + 6) % 7;
    if(dayOfWeek === 0) {
      const weekStart = new Date(d);
      if(isWeekComplete(weekStart)) {
        for(let j = 0; j < 7 && i + j < 42; j++) {
          const futureDay = new Date(d);
          futureDay.setDate(futureDay.getDate() + j);
          if(futureDay.getMonth() === monthIndex) {
            setTimeout(() => {
              const el = grid.children[i + j];
              if(el) el.classList.add('week-complete');
            }, 0);
          }
        }
      }
    }
    
    const blocks = getDayBlocks(dayKey);
    const hours = getDayHours(dayKey);
    
    dayEl.innerHTML = `
      <div class="day-number">${d.getDate()}</div>
      <div class="day-blocks">
        ${blocks.map(b => `<div class="mini-block ${blockTypes[b.type]?.cls || 'study'}"></div>`).join('')}
      </div>
      ${hours > 0 ? `<div class="day-total">${hours}—á</div>` : ''}
    `;
    
    dayEl.onclick = () => openModal(dayKey);
    grid.appendChild(dayEl);
    
    d.setDate(d.getDate() + 1);
  }
  
  return card;
}

function render() {
  const calendar = document.getElementById('calendar');
  calendar.innerHTML = '';
  
  for(let m = 0; m < 12; m++) {
    calendar.appendChild(renderMonth(m));
  }
  
  updateStats();
}

function updateStats() {
  let totalHours = 0;
  let completeWeeks = 0;
  
  Object.keys(state).forEach(key => {
    totalHours += getDayHours(key);
  });
  
  // Count complete weeks
  const d = new Date(year, 0, 1);
  d.setDate(d.getDate() - ((d.getDay() + 6) % 7));
  
  for(let w = 0; w < 54; w++) {
    if(isWeekComplete(new Date(d))) completeWeeks++;
    d.setDate(d.getDate() + 7);
  }
  
  document.getElementById('totalHours').textContent = totalHours;
  document.getElementById('completeWeeks').textContent = completeWeeks;
}

function openModal(dayKey) {
  currentDay = dayKey;
  const date = new Date(dayKey);
  document.getElementById('modalTitle').textContent = 
    `${date.getDate()} ${monthNames[date.getMonth()]} ${year}`;
  
  updateBlocksList();
  document.getElementById('modal').classList.add('open');
}

function closeModal() {
  document.getElementById('modal').classList.remove('open');
  currentDay = null;
}

function updateBlocksList() {
  if(!currentDay) return;
  
  const blocks = getDayBlocks(currentDay);
  const list = document.getElementById('blocksList');
  list.innerHTML = '';
  
  blocks.forEach((block, idx) => {
    const def = blockTypes[block.type];
    const item = document.createElement('div');
    item.className = `block-item ${def?.cls || 'study'}`;
    
    const text = document.createElement('div');
    text.className = 'block-text';
    
    if(block.type === 'custom') {
      text.contentEditable = true;
      text.textContent = block.text || '–°–≤–æ–π –±–ª–æ–∫';
      text.onblur = () => {
        state[currentDay][idx].text = text.textContent;
        save();
      };
    } else {
      text.textContent = def?.text || block.text;
    }
    
    const delBtn = document.createElement('button');
    delBtn.className = 'delete-block-btn';
    delBtn.textContent = '√ó';
    delBtn.onclick = () => {
      state[currentDay].splice(idx, 1);
      if(state[currentDay].length === 0) delete state[currentDay];
      save();
      updateBlocksList();
      render();
    };
    
    item.appendChild(text);
    item.appendChild(delBtn);
    list.appendChild(item);
  });
  
  if(blocks.length === 0) {
    list.innerHTML = '<div style="text-align:center;color:var(--border);padding:20px;">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
  }
}

function addBlock(type) {
  if(!currentDay) return;
  
  state[currentDay] = state[currentDay] || [];
  
  if(type === 'custom') {
    state[currentDay].push({ type: 'custom', text: '–ù–æ–≤—ã–π –±–ª–æ–∫' });
  } else {
    state[currentDay].push({ type });
  }
  
  save();
  updateBlocksList();
  render();
}

// Click outside modal to close
document.getElementById('modal').onclick = (e) => {
  if(e.target.id === 'modal') closeModal();
};

// Init
load();
if(localStorage.getItem('theme') === 'dark') {
  document.body.classList.add('dark');
}
render();
</script>

</body>
</html>
